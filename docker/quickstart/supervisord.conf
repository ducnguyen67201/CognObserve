; docker/quickstart/supervisord.conf
;
; All-in-one process manager for CognObserve Quick Start
; Manages: PostgreSQL, Redis, Temporal, Web, Worker, Ingest

[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
loglevel=info

[unix_http_server]
file=/tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

; ============================================================
; Infrastructure Services (Start First)
; ============================================================

[program:postgresql]
command=/usr/bin/postgres -D /data/postgresql
user=postgres
autostart=true
autorestart=true
priority=100
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:redis]
command=/usr/bin/redis-server --dir /data/redis --appendonly yes --daemonize no
user=redis
autostart=true
autorestart=true
priority=100
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:temporal]
command=/usr/local/bin/temporal server start-dev --ip 0.0.0.0 --db-filename /data/temporal/temporal.db --namespace default
autostart=true
autorestart=true
priority=150
startsecs=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

; ============================================================
; Application Services (Start After Infrastructure)
; ============================================================

[program:web]
command=node /app/apps/web/server.js
directory=/app
autostart=true
autorestart=true
startsecs=10
priority=300
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=NODE_ENV="production",PORT="3000",HOSTNAME="0.0.0.0"

[program:ingest]
command=/app/ingest
directory=/app
autostart=true
autorestart=true
startsecs=5
startretries=10
priority=300
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PORT="8080"

; ============================================================
; Service Groups
; ============================================================

[group:infrastructure]
programs=postgresql,redis,temporal
priority=100

[group:application]
programs=web,ingest
priority=300

; ============================================================
; NOTE: Worker not included in quickstart
; Traces are queued but alerts/background processing requires
; running the worker separately. See docs/self-hosting.
; ============================================================
