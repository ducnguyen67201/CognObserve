; docker/production/supervisord.conf
;
; Application-only supervisor config (no infrastructure)
; For use with Docker Compose where PostgreSQL, Redis, Temporal are separate containers

[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
loglevel=info

[unix_http_server]
file=/tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

; ============================================================
; Web Service (Next.js)
; ============================================================
[program:web]
command=node /app/apps/web/server.js
directory=/app
autostart=true
autorestart=true
startsecs=10
startretries=3
priority=100
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=NODE_ENV="production",PORT="3000",HOSTNAME="0.0.0.0"

; ============================================================
; Worker Service (Temporal Client)
; ============================================================
[program:worker]
command=node /app/apps/worker/dist/index.js
directory=/app
autostart=true
autorestart=true
startsecs=15
startretries=5
priority=200
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=NODE_ENV="production"

; ============================================================
; Ingest Service (Go)
; ============================================================
[program:ingest]
command=/app/ingest
directory=/app
autostart=true
autorestart=true
startsecs=5
startretries=3
priority=100
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PORT="8080"

; ============================================================
; Service Group
; ============================================================
[group:cognobserve]
programs=web,worker,ingest
priority=999
